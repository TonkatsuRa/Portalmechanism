<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Metaplane Portal Interface</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: 'Courier New', monospace;
            background: #030508;
            color: #00ffcc;
            height: 100vh;
        }

        .bg-layer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .bg-gradient {
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(0, 80, 80, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(0, 60, 100, 0.1) 0%, transparent 50%),
                linear-gradient(180deg, #030508 0%, #0a0f18 50%, #030508 100%);
        }
        .bg-stars {
            background-image: 
                radial-gradient(1px 1px at 10% 10%, rgba(0, 255, 204, 0.4), transparent),
                radial-gradient(1px 1px at 20% 40%, rgba(0, 200, 180, 0.3), transparent),
                radial-gradient(2px 2px at 35% 15%, rgba(0, 255, 204, 0.5), transparent),
                radial-gradient(1px 1px at 65% 30%, rgba(0, 255, 204, 0.4), transparent),
                radial-gradient(2px 2px at 80% 60%, rgba(0, 200, 180, 0.3), transparent);
            animation: twinkle 8s ease-in-out infinite alternate;
        }
        @keyframes twinkle { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        .bg-grid {
            background-image: 
                linear-gradient(rgba(0, 255, 204, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 204, 0.02) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        .main-container {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            padding: 50px 20px 20px 20px;
        }

        .interface-frame {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: clamp(20px, 4vw, 60px);
            width: 100%;
            max-width: 1400px;
            height: 100%;
        }

        .title-bar {
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(0, 20, 30, 0.95) 0%, transparent 100%);
            border-bottom: 1px solid rgba(0, 255, 204, 0.1);
            z-index: 10;
        }
        .title {
            font-size: clamp(0.8rem, 1.8vw, 1.1rem);
            color: #00ffcc;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.8), 0 0 20px rgba(0, 255, 204, 0.4);
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        .sound-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(10, 20, 30, 0.9);
            border: 1px solid rgba(0, 255, 204, 0.3);
            border-radius: 4px;
            padding: 5px 10px;
            color: #00ccaa;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s ease;
        }
        .sound-toggle:hover { border-color: #00ffcc; background: rgba(0, 255, 204, 0.1); }
        .sound-toggle.muted { color: #ff6688; border-color: rgba(255, 102, 136, 0.3); }

        .portal-section {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
            min-height: 0;
        }
        .portal-frame {
            position: relative;
            width: min(70vh, 60vw, 550px);
            aspect-ratio: 1;
        }
        #particleCanvas {
            position: absolute;
            top: -10%; left: -10%;
            width: 120%; height: 120%;
            pointer-events: none;
            z-index: 10;
        }
        .portal-ring {
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, transparent 56%, rgba(0, 20, 30, 0.95) 58%, rgba(15, 35, 50, 0.98) 100%);
            box-shadow: 
                inset 0 0 50px rgba(0, 255, 204, 0.1),
                inset 0 0 100px rgba(0, 100, 100, 0.08),
                0 0 30px rgba(0, 255, 204, 0.12),
                0 0 60px rgba(0, 255, 204, 0.06);
        }
        .portal-ring::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            border-radius: 50%;
            border: 2px solid rgba(0, 255, 204, 0.15);
        }
        .portal-ring::after {
            content: '';
            position: absolute;
            top: -10px; left: -10px; right: -10px; bottom: -10px;
            border-radius: 50%;
            border: 1px solid rgba(0, 255, 204, 0.06);
        }

        .ring-track {
            position: absolute;
            top: 5%; left: 5%; right: 5%; bottom: 5%;
            border-radius: 50%;
            border: 2px solid rgba(0, 50, 60, 0.8);
        }
        .ring-track::before {
            content: '';
            position: absolute;
            top: 4px; left: 4px; right: 4px; bottom: 4px;
            border-radius: 50%;
            border: 1px dashed rgba(0, 255, 204, 0.15);
        }
        .ring-track.rotating::before {
            animation: ringRotate 0.6s cubic-bezier(0.2, 0.8, 0.3, 1);
        }
        @keyframes ringRotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(30deg); } }

        .symbol-holder { position: absolute; width: 100%; height: 100%; top: 0; left: 0; }
        .symbol-marker {
            position: absolute;
            width: clamp(24px, 7%, 36px);
            height: clamp(24px, 7%, 36px);
            margin-left: clamp(-12px, -3.5%, -18px);
            margin-top: clamp(-12px, -3.5%, -18px);
            background: linear-gradient(145deg, #0a1520, #05101a);
            border: 2px solid #1a3a4a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(9px, 2vmin, 14px);
            font-weight: bold;
            color: #2a5a6a;
            transition: background 0.3s, border-color 0.3s, color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5), 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .symbol-marker.active {
            background: radial-gradient(circle, #00ffcc 0%, #00aa88 100%);
            border-color: #00ffcc;
            color: #001a15;
            box-shadow: 0 0 12px rgba(0, 255, 204, 0.8), 0 0 25px rgba(0, 255, 204, 0.5), inset 0 0 8px rgba(255, 255, 255, 0.4);
            animation: chevronActivate 0.5s ease-out forwards;
        }
        .symbol-marker.locked {
            background: radial-gradient(circle, #00ccaa 0%, #007766 100%);
            border-color: #00ddbb;
            color: #001a15;
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.5), 0 0 20px rgba(0, 255, 204, 0.2);
        }
        .symbol-marker.error {
            background: radial-gradient(circle, #ff3366 0%, #aa1133 100%);
            border-color: #ff3366;
            color: #fff;
            box-shadow: 0 0 20px rgba(255, 51, 102, 0.7);
            animation: chevronError 0.1s ease-out 4;
        }
        @keyframes chevronActivate { 0% { transform: scale(1); } 40% { transform: scale(1.2); } 70% { transform: scale(0.95); } 100% { transform: scale(1); } }
        @keyframes chevronError { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        .portal-center {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 56%; height: 56%;
            border-radius: 50%;
            background: radial-gradient(circle, #020408 0%, #050a10 100%);
            overflow: hidden;
            border: 1px solid rgba(0, 255, 204, 0.08);
            box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.9);
        }
        .event-horizon {
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }
        .event-horizon.active { opacity: 1; }
        .event-horizon.active::before {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(100, 255, 230, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0, 200, 180, 0.2) 0%, transparent 50%),
                radial-gradient(circle, rgba(0, 255, 204, 0.45) 0%, rgba(0, 200, 180, 0.3) 30%, transparent 70%);
            animation: horizonRipple 3s ease-in-out infinite;
        }
        .event-horizon.active::after {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, transparent, rgba(0, 255, 204, 0.1) 30deg, transparent 60deg, rgba(0, 255, 204, 0.08) 120deg, transparent 150deg, rgba(0, 255, 204, 0.12) 210deg, transparent 240deg, rgba(0, 255, 204, 0.08) 300deg, transparent);
            animation: vortexRotate 8s linear infinite;
        }
        @keyframes horizonRipple { 0%, 100% { transform: scale(0.96); opacity: 0.8; } 50% { transform: scale(1.02); opacity: 1; } }
        @keyframes vortexRotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .kawoosh, .kawoosh-inner { position: absolute; width: 100%; height: 100%; border-radius: 50%; opacity: 0; pointer-events: none; }
        .kawoosh { z-index: 15; }
        .kawoosh-inner { z-index: 14; }
        .kawoosh.active { animation: kawooshEffect 2s ease-out forwards; }
        @keyframes kawooshEffect {
            0% { opacity: 0; transform: scale(0.3); }
            8% { opacity: 1; transform: scale(1); background: radial-gradient(circle, rgba(255, 255, 255, 1) 0%, rgba(150, 255, 240, 0.9) 20%, rgba(0, 255, 204, 0.7) 40%, transparent 70%); box-shadow: 0 0 50px 25px rgba(255, 255, 255, 0.8), 0 0 100px 50px rgba(0, 255, 204, 0.6); }
            20% { opacity: 1; transform: scale(2.5); background: radial-gradient(circle, rgba(0, 255, 204, 0.8) 0%, rgba(0, 200, 180, 0.5) 30%, transparent 60%); }
            50% { opacity: 0.6; transform: scale(1.5); }
            100% { opacity: 0; transform: scale(0.8); }
        }
        .kawoosh-inner.active { animation: kawooshInner 2s ease-out forwards; }
        @keyframes kawooshInner {
            0% { opacity: 0; transform: scale(0.5); }
            10% { opacity: 1; transform: scale(1.8); background: radial-gradient(circle, rgba(200, 255, 250, 0.9) 0%, transparent 60%); }
            30% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.8); }
        }

        .console-section {
            width: clamp(220px, 25vw, 320px);
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-shrink: 0;
        }
        .console {
            background: linear-gradient(145deg, rgba(10, 20, 30, 0.95), rgba(5, 12, 20, 0.98));
            border: 1px solid rgba(0, 255, 204, 0.12);
            border-radius: 8px;
            padding: clamp(10px, 1.5vw, 16px);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(0, 255, 204, 0.03);
            display: flex;
            flex-direction: column;
            gap: clamp(8px, 1vw, 12px);
            overflow: hidden;
        }
        .console-header {
            font-size: 0.65rem;
            color: rgba(0, 255, 204, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-align: center;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(0, 255, 204, 0.08);
        }
        .status-display {
            background: linear-gradient(180deg, rgba(5, 10, 18, 0.9), rgba(8, 15, 25, 0.95));
            border: 1px solid rgba(0, 255, 204, 0.08);
            border-radius: 4px;
            padding: 10px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .status-display::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 204, 0.02), transparent);
            animation: scanline 4s linear infinite;
        }
        @keyframes scanline { 0% { left: -50%; } 100% { left: 150%; } }
        .status-text {
            font-size: 0.7rem;
            color: #00ffcc;
            text-shadow: 0 0 6px rgba(0, 255, 204, 0.4);
            z-index: 1;
            letter-spacing: 0.5px;
        }

        .coordinate-display { display: flex; justify-content: center; gap: clamp(4px, 0.5vw, 6px); }
        .coord-slot {
            width: clamp(26px, 3.5vw, 36px); 
            height: clamp(26px, 3.5vw, 36px);
            background: linear-gradient(180deg, rgba(8, 15, 25, 0.9), rgba(5, 10, 18, 0.95));
            border: 1px solid rgba(0, 255, 204, 0.12);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(0.8rem, 1.2vw, 1rem);
            font-weight: bold;
            color: rgba(0, 255, 204, 0.15);
            transition: all 0.3s ease;
        }
        .coord-slot.filled {
            background: linear-gradient(145deg, #00aa88, #008866);
            border-color: #00ffcc;
            color: #001a15;
            box-shadow: 0 0 8px rgba(0, 255, 204, 0.3);
            animation: slotFill 0.3s ease-out;
        }
        @keyframes slotFill { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .symbol-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: clamp(4px, 0.5vw, 6px);
        }
        .symbol-button {
            aspect-ratio: 1;
            background: linear-gradient(145deg, rgba(15, 25, 40, 0.9), rgba(8, 15, 25, 0.95));
            border: 1px solid rgba(0, 255, 204, 0.15);
            border-radius: 4px;
            font-size: clamp(1.1rem, 2vw, 1.4rem);
            font-weight: bold;
            color: #3a7a8a;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            padding: 0;
            min-height: clamp(32px, 4vw, 44px);
        }
        .symbol-button:hover:not(:disabled) {
            background: linear-gradient(145deg, rgba(0, 50, 50, 0.8), rgba(0, 40, 40, 0.9));
            border-color: #00ccaa;
            color: #00ffcc;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4), 0 0 10px rgba(0, 255, 204, 0.08);
        }
        .symbol-button:disabled { opacity: 0.3; cursor: not-allowed; }

        .action-buttons { display: flex; gap: clamp(6px, 0.8vw, 10px); }
        .action-btn {
            flex: 1;
            padding: clamp(8px, 1vw, 12px) clamp(10px, 1.2vw, 15px);
            background: linear-gradient(145deg, rgba(15, 30, 45, 0.9), rgba(10, 20, 35, 0.95));
            border: 1px solid #00aa88;
            border-radius: 4px;
            color: #00ffcc;
            font-size: clamp(0.6rem, 0.9vw, 0.75rem);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.25s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .action-btn:hover:not(:disabled) {
            background: linear-gradient(145deg, #00ccaa, #009977);
            border-color: #00ffcc;
            color: #001a15;
            box-shadow: 0 0 12px rgba(0, 255, 204, 0.3);
        }
        .action-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        .lockout-timer {
            background: linear-gradient(145deg, rgba(40, 15, 25, 0.9), rgba(30, 10, 18, 0.95));
            border: 1px solid #ff3366;
            border-radius: 4px;
            padding: 8px;
            text-align: center;
            display: none;
        }
        .lockout-timer.active { display: block; animation: lockoutGlow 1.5s ease-in-out infinite; }
        @keyframes lockoutGlow { 0%, 100% { box-shadow: 0 0 6px rgba(255, 51, 102, 0.2); } 50% { box-shadow: 0 0 15px rgba(255, 51, 102, 0.5); } }
        .lockout-text { color: #ff6688; font-size: 0.7rem; font-weight: bold; text-shadow: 0 0 6px rgba(255, 51, 102, 0.4); }

        .destination-name {
            font-size: 0.8rem;
            color: #00ffcc;
            text-shadow: 0 0 8px rgba(0, 255, 204, 0.8), 0 0 15px rgba(0, 255, 204, 0.5);
            animation: destinationReveal 1.2s ease-out;
            letter-spacing: 1px;
        }
        @keyframes destinationReveal { 0% { opacity: 0; transform: scale(0.7); filter: blur(8px); } 60% { opacity: 1; transform: scale(1.05); filter: blur(0); } 100% { transform: scale(1); } }

        /* Tablet/Mobile Layout */
        @media (max-width: 900px), (max-aspect-ratio: 4/5) {
            .main-container { padding: 45px 15px 15px 15px; }
            .interface-frame { flex-direction: column; gap: 15px; }
            .portal-section { flex: 0 0 auto; }
            .portal-frame { width: min(50vh, 70vw, 320px); }
            .console-section { width: min(90vw, 400px); }
            .console { padding: 10px; gap: 8px; }
            .console-header { display: none; }
            .symbol-grid { grid-template-columns: repeat(6, 1fr); gap: 4px; }
            .symbol-button { min-height: 36px; font-size: 1rem; }
            .coord-slot { width: 28px; height: 28px; font-size: 0.8rem; }
            .status-display { padding: 8px; min-height: 32px; }
            .status-text { font-size: 0.65rem; }
            .action-btn { padding: 8px 10px; font-size: 0.6rem; }
        }
    </style>
</head>
<body>
    <div class="bg-layer bg-gradient"></div>
    <div class="bg-layer bg-stars"></div>
    <div class="bg-layer bg-grid"></div>

    <div class="title-bar">
        <div class="title">Metaplane Portal Interface</div>
        <button class="sound-toggle" id="soundToggle">ðŸ”Š ON</button>
    </div>

    <div class="main-container">
        <div class="interface-frame">
            <div class="portal-section">
                <div class="portal-frame">
                <canvas id="particleCanvas"></canvas>
                <div class="portal-ring">
                    <div class="ring-track" id="ringTrack"></div>
                    <div class="symbol-holder" id="symbolHolder"></div>
                </div>
                <div class="portal-center">
                    <div class="kawoosh-inner" id="kawooshInner"></div>
                    <div class="kawoosh" id="kawoosh"></div>
                    <div class="event-horizon" id="eventHorizon"></div>
                </div>
                </div>
            </div>

            <div class="console-section">
            <div class="console">
                <div class="console-header">Coordinate Entry System</div>
                <div class="status-display">
                    <div class="status-text" id="statusText">Enter destination coordinates...</div>
                </div>
                <div class="coordinate-display">
                    <div class="coord-slot"></div>
                    <div class="coord-slot"></div>
                    <div class="coord-slot"></div>
                    <div class="coord-slot"></div>
                    <div class="coord-slot"></div>
                    <div class="coord-slot"></div>
                    <div class="coord-slot"></div>
                </div>
                <div class="symbol-grid" id="symbolGrid">
                    <button class="symbol-button" data-index="0">Î©</button>
                    <button class="symbol-button" data-index="1">Î¨</button>
                    <button class="symbol-button" data-index="2">Î¦</button>
                    <button class="symbol-button" data-index="3">Î˜</button>
                    <button class="symbol-button" data-index="4">Î”</button>
                    <button class="symbol-button" data-index="5">Î£</button>
                    <button class="symbol-button" data-index="6">Î›</button>
                    <button class="symbol-button" data-index="7">Îž</button>
                    <button class="symbol-button" data-index="8">Î </button>
                    <button class="symbol-button" data-index="9">Î“</button>
                    <button class="symbol-button" data-index="10">Ï </button>
                    <button class="symbol-button" data-index="11">Ïž</button>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" id="resetBtn">Reset</button>
                    <button class="action-btn" id="activateBtn" disabled>Activate</button>
                </div>
                <div class="lockout-timer" id="lockoutTimer">
                    <div class="lockout-text" id="lockoutText">âš  SECURITY LOCKOUT: 60s âš </div>
                </div>
            </div>
        </div>
        </div>
    </div>
    <script>
        class PortalSoundEngine {
            constructor() { this.audioContext = null; this.masterGain = null; this.muted = false; this.initialized = false; this.activeNodes = []; this.ambientNodes = []; }
            init() { if (this.initialized) return; this.audioContext = new (window.AudioContext || window.webkitAudioContext)(); this.masterGain = this.audioContext.createGain(); this.masterGain.connect(this.audioContext.destination); this.masterGain.gain.value = 0.6; this.initialized = true; }
            toggleMute() { this.muted = !this.muted; if (this.masterGain) this.masterGain.gain.setTargetAtTime(this.muted ? 0 : 0.6, this.audioContext.currentTime, 0.1); return this.muted; }
            stopAllSounds() { this.activeNodes.forEach(n => { try { if(n.stop)n.stop(); if(n.disconnect)n.disconnect(); } catch(e){} }); this.activeNodes = []; this.stopAmbient(); }
            stopAmbient() { this.ambientNodes.forEach(n => { try { if(n.gain)n.gain.setTargetAtTime(0, this.audioContext.currentTime, 0.2); setTimeout(() => { try { if(n.stop)n.stop(); if(n.disconnect)n.disconnect(); } catch(e){} }, 400); } catch(e){} }); this.ambientNodes = []; }
            createNoiseBuffer(d) { const sr = this.audioContext.sampleRate, b = this.audioContext.createBuffer(2, sr * d, sr); for (let c = 0; c < 2; c++) { const data = b.getChannelData(c); for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1; } return b; }
            playChevronLock(n) { if (!this.initialized || this.muted) return; const now = this.audioContext.currentTime; const t = this.audioContext.createOscillator(), tg = this.audioContext.createGain(); t.type = 'sine'; t.frequency.setValueAtTime(80, now); t.frequency.exponentialRampToValueAtTime(30, now + 0.15); tg.gain.setValueAtTime(0.8, now); tg.gain.exponentialRampToValueAtTime(0.001, now + 0.2); t.connect(tg); tg.connect(this.masterGain); t.start(now); t.stop(now + 0.2); this.activeNodes.push(t); const p = this.audioContext.createOscillator(), pg = this.audioContext.createGain(), pf = this.audioContext.createBiquadFilter(); p.type = 'sine'; p.frequency.setValueAtTime(400 + n * 30, now); p.frequency.exponentialRampToValueAtTime(200, now + 0.5); pf.type = 'bandpass'; pf.frequency.value = 600; pf.Q.value = 15; pg.gain.setValueAtTime(0.15, now); pg.gain.exponentialRampToValueAtTime(0.001, now + 0.5); p.connect(pf); pf.connect(pg); pg.connect(this.masterGain); p.start(now); p.stop(now + 0.5); this.activeNodes.push(p); const hb = this.createNoiseBuffer(0.3), h = this.audioContext.createBufferSource(); h.buffer = hb; const hf = this.audioContext.createBiquadFilter(), hg = this.audioContext.createGain(); hf.type = 'bandpass'; hf.frequency.setValueAtTime(4000, now); hf.frequency.exponentialRampToValueAtTime(1500, now + 0.3); hf.Q.value = 1; hg.gain.setValueAtTime(0.08, now); hg.gain.exponentialRampToValueAtTime(0.001, now + 0.3); h.connect(hf); hf.connect(hg); hg.connect(this.masterGain); h.start(now); this.activeNodes.push(h); }
            playRingRotation() { if (!this.initialized || this.muted) return; const now = this.audioContext.currentTime, d = 0.5; const rb = this.createNoiseBuffer(d), r = this.audioContext.createBufferSource(); r.buffer = rb; const rf = this.audioContext.createBiquadFilter(), rg = this.audioContext.createGain(); rf.type = 'lowpass'; rf.frequency.setValueAtTime(150, now); rf.frequency.linearRampToValueAtTime(300, now + d * 0.3); rf.frequency.linearRampToValueAtTime(150, now + d); rf.Q.value = 3; rg.gain.setValueAtTime(0, now); rg.gain.linearRampToValueAtTime(0.25, now + 0.05); rg.gain.setValueAtTime(0.25, now + d - 0.1); rg.gain.linearRampToValueAtTime(0, now + d); r.connect(rf); rf.connect(rg); rg.connect(this.masterGain); r.start(now); this.activeNodes.push(r); const g1 = this.audioContext.createOscillator(), g2 = this.audioContext.createOscillator(), gg = this.audioContext.createGain(); g1.type = 'sawtooth'; g1.frequency.setValueAtTime(40, now); g1.frequency.linearRampToValueAtTime(60, now + d * 0.5); g1.frequency.linearRampToValueAtTime(35, now + d); g2.type = 'square'; g2.frequency.setValueAtTime(42, now); g2.frequency.linearRampToValueAtTime(62, now + d * 0.5); g2.frequency.linearRampToValueAtTime(37, now + d); gg.gain.setValueAtTime(0, now); gg.gain.linearRampToValueAtTime(0.1, now + 0.03); gg.gain.setValueAtTime(0.1, now + d - 0.05); gg.gain.linearRampToValueAtTime(0, now + d); g1.connect(gg); g2.connect(gg); gg.connect(this.masterGain); g1.start(now); g1.stop(now + d); g2.start(now); g2.stop(now + d); this.activeNodes.push(g1, g2); }
            playButtonClick() { if (!this.initialized || this.muted) return; const now = this.audioContext.currentTime; const c1 = this.audioContext.createOscillator(), c2 = this.audioContext.createOscillator(), cg = this.audioContext.createGain(); c1.type = 'sine'; c1.frequency.setValueAtTime(1200, now); c1.frequency.exponentialRampToValueAtTime(800, now + 0.1); c2.type = 'sine'; c2.frequency.setValueAtTime(1800, now); c2.frequency.exponentialRampToValueAtTime(1200, now + 0.08); cg.gain.setValueAtTime(0.12, now); cg.gain.exponentialRampToValueAtTime(0.001, now + 0.12); c1.connect(cg); c2.connect(cg); cg.connect(this.masterGain); c1.start(now); c1.stop(now + 0.12); c2.start(now); c2.stop(now + 0.1); this.activeNodes.push(c1, c2); }
            playError() { if (!this.initialized || this.muted) return; const now = this.audioContext.currentTime; for (let i = 0; i < 3; i++) { const t = now + i * 0.18; const a1 = this.audioContext.createOscillator(), a2 = this.audioContext.createOscillator(), ag = this.audioContext.createGain(); a1.type = 'square'; a1.frequency.value = 220; a2.type = 'square'; a2.frequency.value = 277; ag.gain.setValueAtTime(0.2, t); ag.gain.setValueAtTime(0.2, t + 0.1); ag.gain.exponentialRampToValueAtTime(0.001, t + 0.15); a1.connect(ag); a2.connect(ag); ag.connect(this.masterGain); a1.start(t); a1.stop(t + 0.15); a2.start(t); a2.stop(t + 0.15); this.activeNodes.push(a1, a2); } }
            playKawoosh() { if (!this.initialized || this.muted) return; const now = this.audioContext.currentTime; const s = this.audioContext.createOscillator(), sg = this.audioContext.createGain(), sf = this.audioContext.createBiquadFilter(); s.type = 'sawtooth'; s.frequency.setValueAtTime(50, now); s.frequency.exponentialRampToValueAtTime(200, now + 0.4); sf.type = 'lowpass'; sf.frequency.setValueAtTime(100, now); sf.frequency.exponentialRampToValueAtTime(1000, now + 0.4); sg.gain.setValueAtTime(0.05, now); sg.gain.exponentialRampToValueAtTime(0.4, now + 0.35); sg.gain.exponentialRampToValueAtTime(0.001, now + 0.5); s.connect(sf); sf.connect(sg); sg.connect(this.masterGain); s.start(now); s.stop(now + 0.5); this.activeNodes.push(s); const wb = this.createNoiseBuffer(2.5), w = this.audioContext.createBufferSource(); w.buffer = wb; const wf = this.audioContext.createBiquadFilter(), wg = this.audioContext.createGain(); wf.type = 'bandpass'; wf.frequency.setValueAtTime(200, now + 0.35); wf.frequency.exponentialRampToValueAtTime(3000, now + 0.5); wf.frequency.exponentialRampToValueAtTime(400, now + 1.5); wf.frequency.exponentialRampToValueAtTime(100, now + 2.5); wf.Q.value = 1; wg.gain.setValueAtTime(0, now); wg.gain.setValueAtTime(0, now + 0.35); wg.gain.linearRampToValueAtTime(0.7, now + 0.45); wg.gain.exponentialRampToValueAtTime(0.001, now + 2.5); w.connect(wf); wf.connect(wg); wg.connect(this.masterGain); w.start(now); this.activeNodes.push(w); const b = this.audioContext.createOscillator(), bg = this.audioContext.createGain(); b.type = 'sine'; b.frequency.setValueAtTime(60, now + 0.35); b.frequency.exponentialRampToValueAtTime(20, now + 2); bg.gain.setValueAtTime(0, now); bg.gain.setValueAtTime(0.6, now + 0.35); bg.gain.exponentialRampToValueAtTime(0.001, now + 2); b.connect(bg); bg.connect(this.masterGain); b.start(now); b.stop(now + 2); this.activeNodes.push(b); const shb = this.createNoiseBuffer(1.5), sh = this.audioContext.createBufferSource(); sh.buffer = shb; const shf = this.audioContext.createBiquadFilter(), shg = this.audioContext.createGain(); shf.type = 'highpass'; shf.frequency.value = 3000; shg.gain.setValueAtTime(0, now); shg.gain.setValueAtTime(0.15, now + 0.35); shg.gain.exponentialRampToValueAtTime(0.001, now + 1.2); sh.connect(shf); shf.connect(shg); shg.connect(this.masterGain); sh.start(now); this.activeNodes.push(sh); }
            playEventHorizonAmbient() { if (!this.initialized || this.muted) return; this.stopAmbient(); const now = this.audioContext.currentTime; const h1 = this.audioContext.createOscillator(), h2 = this.audioContext.createOscillator(), hg = this.audioContext.createGain(), hf = this.audioContext.createBiquadFilter(); h1.type = 'sine'; h1.frequency.value = 60; h2.type = 'sine'; h2.frequency.value = 120; hf.type = 'lowpass'; hf.frequency.value = 200; hg.gain.setValueAtTime(0, now); hg.gain.linearRampToValueAtTime(0.08, now + 1.5); h1.connect(hf); h2.connect(hf); hf.connect(hg); hg.connect(this.masterGain); h1.start(now); h2.start(now); this.ambientNodes.push(h1, h2, hg); const wb = this.createNoiseBuffer(4), w = this.audioContext.createBufferSource(); w.buffer = wb; w.loop = true; const wf = this.audioContext.createBiquadFilter(), wf2 = this.audioContext.createBiquadFilter(), wg = this.audioContext.createGain(), lfo = this.audioContext.createOscillator(), lfog = this.audioContext.createGain(); wf.type = 'bandpass'; wf.frequency.value = 800; wf.Q.value = 2; wf2.type = 'lowpass'; wf2.frequency.value = 2000; lfo.type = 'sine'; lfo.frequency.value = 0.3; lfog.gain.value = 300; lfo.connect(lfog); lfog.connect(wf.frequency); wg.gain.setValueAtTime(0, now); wg.gain.linearRampToValueAtTime(0.06, now + 2); w.connect(wf); wf.connect(wf2); wf2.connect(wg); wg.connect(this.masterGain); lfo.start(now); w.start(now); this.ambientNodes.push(w, lfo, wg); const so = this.audioContext.createOscillator(), sg = this.audioContext.createGain(), slfo = this.audioContext.createOscillator(), slfog = this.audioContext.createGain(); so.type = 'sine'; so.frequency.value = 2000; slfo.type = 'sine'; slfo.frequency.value = 4; slfog.gain.value = 200; slfo.connect(slfog); slfog.connect(so.frequency); sg.gain.setValueAtTime(0, now); sg.gain.linearRampToValueAtTime(0.015, now + 2); so.connect(sg); sg.connect(this.masterGain); slfo.start(now); so.start(now); this.ambientNodes.push(so, slfo, sg); }
            playReset() { if (!this.initialized || this.muted) return; const now = this.audioContext.currentTime; const d = this.audioContext.createOscillator(), dg = this.audioContext.createGain(), df = this.audioContext.createBiquadFilter(); d.type = 'sawtooth'; d.frequency.setValueAtTime(300, now); d.frequency.exponentialRampToValueAtTime(30, now + 0.6); df.type = 'lowpass'; df.frequency.setValueAtTime(1000, now); df.frequency.exponentialRampToValueAtTime(50, now + 0.6); dg.gain.setValueAtTime(0.15, now); dg.gain.exponentialRampToValueAtTime(0.001, now + 0.6); d.connect(df); df.connect(dg); dg.connect(this.masterGain); d.start(now); d.stop(now + 0.6); this.activeNodes.push(d); }
        }

        class ParticleSystem {
            constructor(canvas) { this.canvas = canvas; this.ctx = canvas.getContext('2d'); this.particles = []; this.active = false; this.animationId = null; this.resize(); }
            resize() { const rect = this.canvas.parentElement.getBoundingClientRect(); this.canvas.width = rect.width * 1.2; this.canvas.height = rect.height * 1.2; this.centerX = this.canvas.width / 2; this.centerY = this.canvas.height / 2; this.radius = Math.min(this.canvas.width, this.canvas.height) * 0.24; }
            createVortexParticle() { const a = Math.random() * Math.PI * 2; return { angle: a, radius: this.radius + Math.random() * 25, angularSpeed: (Math.random() * 0.01 + 0.005) * (Math.random() > 0.5 ? 1 : -1), radialSpeed: Math.random() * 0.5 + 0.25, size: Math.random() * 1.5 + 0.5, alpha: Math.random() * 0.5 + 0.3, hue: 165 + Math.random() * 25, trail: [] }; }
            createBurstParticle() { const a = Math.random() * Math.PI * 2, sp = Math.random() * 8 + 4; return { x: this.centerX, y: this.centerY, vx: Math.cos(a) * sp, vy: Math.sin(a) * sp, size: Math.random() * 2.5 + 1, alpha: 1, hue: 160 + Math.random() * 40, life: 1, decay: Math.random() * 0.015 + 0.008 }; }
            startVortex() { this.stop(); this.active = true; this.mode = 'vortex'; this.particles = []; for (let i = 0; i < 50; i++) this.particles.push(this.createVortexParticle()); this.animate(); }
            burst() { if (!this.active) { this.active = true; this.mode = 'burst'; this.animate(); } for (let i = 0; i < 120; i++) this.particles.push(this.createBurstParticle()); }
            stop() { this.active = false; if (this.animationId) { cancelAnimationFrame(this.animationId); this.animationId = null; } this.particles = []; this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); }
            animate() { if (!this.active) return; this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); for (let i = this.particles.length - 1; i >= 0; i--) { const p = this.particles[i]; if (this.mode === 'vortex') { p.angle += p.angularSpeed; p.radius -= p.radialSpeed; const x = this.centerX + Math.cos(p.angle) * p.radius, y = this.centerY + Math.sin(p.angle) * p.radius; p.trail.push({x, y, alpha: p.alpha}); if (p.trail.length > 5) p.trail.shift(); p.trail.forEach((t, idx) => { const ta = (idx / p.trail.length) * t.alpha * 0.35; this.ctx.beginPath(); this.ctx.arc(t.x, t.y, p.size * 0.5, 0, Math.PI * 2); this.ctx.fillStyle = `hsla(${p.hue}, 100%, 65%, ${ta})`; this.ctx.fill(); }); this.ctx.beginPath(); this.ctx.arc(x, y, p.size, 0, Math.PI * 2); this.ctx.fillStyle = `hsla(${p.hue}, 100%, 70%, ${p.alpha})`; this.ctx.fill(); if (p.radius < 10) this.particles[i] = this.createVortexParticle(); } else if (this.mode === 'burst') { p.x += p.vx; p.y += p.vy; p.vx *= 0.97; p.vy *= 0.97; p.life -= p.decay; p.alpha = p.life; if (p.life <= 0) { this.particles.splice(i, 1); continue; } this.ctx.beginPath(); this.ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2); this.ctx.fillStyle = `hsla(${p.hue}, 100%, 70%, ${p.alpha})`; this.ctx.fill(); } } this.animationId = requestAnimationFrame(() => this.animate()); }
        }

        function positionSymbols() {
            const SYMBOLS = ['Î©', 'Î¨', 'Î¦', 'Î˜', 'Î”', 'Î£', 'Î›', 'Îž', 'Î ', 'Î“', 'Ï ', 'Ïž'];
            const holder = document.getElementById('symbolHolder');
            holder.innerHTML = '';
            SYMBOLS.forEach((sym, i) => {
                const m = document.createElement('div');
                m.className = 'symbol-marker';
                m.id = `marker-${i}`;
                m.textContent = sym;
                const ang = (i * 30 - 90) * (Math.PI / 180), rad = 46;
                m.style.left = `${50 + rad * Math.cos(ang)}%`;
                m.style.top = `${50 + rad * Math.sin(ang)}%`;
                holder.appendChild(m);
            });
        }

        const ENCODED_DESTINATIONS = [
            { coords: 'MCwxLDUsNCwyLDUsNg==', name: 'VEhFIEFTVFJBTCBORVhVUw==' },
            { coords: 'Miw0LDMsOSw3LDUsOA==', name: 'U0hBRE9XIFJFQUxNIEdBVEVXQVk=' },
            { coords: 'Myw2LDEsMTAsNSwxMSw5', name: 'RVRIRVJFQUwgUExBTkU=' },
            { coords: 'OCw5LDEwLDQsMCw3LDI=', name: 'TUFOQSBDT05EVUlU' }
        ];
        const SYMBOLS = ['Î©', 'Î¨', 'Î¦', 'Î˜', 'Î”', 'Î£', 'Î›', 'Îž', 'Î ', 'Î“', 'Ï ', 'Ïž'];

        let currentSequence = [], isLocked = false, lockoutInterval = null, lockoutEndTime = null, portalOpen = false;
        const soundEngine = new PortalSoundEngine();
        const particleCanvas = document.getElementById('particleCanvas');
        const particleSystem = new ParticleSystem(particleCanvas);
        positionSymbols();

        const symbolButtons = document.querySelectorAll('.symbol-button');
        const coordSlots = document.querySelectorAll('.coord-slot');
        const statusText = document.getElementById('statusText');
        const resetBtn = document.getElementById('resetBtn');
        const activateBtn = document.getElementById('activateBtn');
        const ringTrack = document.getElementById('ringTrack');
        const lockoutTimer = document.getElementById('lockoutTimer');
        const lockoutText = document.getElementById('lockoutText');
        const eventHorizon = document.getElementById('eventHorizon');
        const kawoosh = document.getElementById('kawoosh');
        const kawooshInner = document.getElementById('kawooshInner');
        const soundToggle = document.getElementById('soundToggle');

        document.body.addEventListener('click', () => soundEngine.init(), { once: true });
        soundToggle.addEventListener('click', (e) => { e.stopPropagation(); soundEngine.init(); const m = soundEngine.toggleMute(); soundToggle.textContent = m ? 'ðŸ”‡ OFF' : 'ðŸ”Š ON'; soundToggle.classList.toggle('muted', m); });

        function lightUpSymbol(idx) { const m = document.getElementById(`marker-${idx}`); if (m) { m.classList.add('active'); setTimeout(() => { m.classList.remove('active'); m.classList.add('locked'); }, 500); } ringTrack.classList.add('rotating'); setTimeout(() => ringTrack.classList.remove('rotating'), 600); soundEngine.playChevronLock(currentSequence.length); soundEngine.playRingRotation(); }
        function addSymbol(idx) { if (currentSequence.length >= 7 || isLocked) return; soundEngine.playButtonClick(); currentSequence.push(parseInt(idx)); updateDisplay(); lightUpSymbol(idx); if (currentSequence.length === 7) { activateBtn.disabled = false; statusText.textContent = 'Sequence complete. Ready to activate...'; } }
        function updateDisplay() { coordSlots.forEach((s, i) => { if (i < currentSequence.length) { s.textContent = SYMBOLS[currentSequence[i]]; s.classList.add('filled'); } else { s.textContent = ''; s.classList.remove('filled'); } }); }
        function resetSequence() { if (isLocked) return; soundEngine.stopAllSounds(); soundEngine.playReset(); currentSequence = []; portalOpen = false; updateDisplay(); activateBtn.disabled = true; statusText.textContent = 'Enter destination coordinates...'; statusText.style.color = ''; document.querySelectorAll('.symbol-marker').forEach(m => m.classList.remove('active', 'error', 'locked')); eventHorizon.classList.remove('active'); kawoosh.classList.remove('active'); kawooshInner.classList.remove('active'); particleSystem.stop(); symbolButtons.forEach(b => b.disabled = false); resetBtn.disabled = false; }
        function showError() { statusText.textContent = 'âš  INVALID COORDINATES âš '; statusText.style.color = '#ff6688'; soundEngine.playError(); document.querySelectorAll('.symbol-marker').forEach(m => { m.classList.remove('locked'); m.classList.add('error'); }); coordSlots.forEach(s => { s.style.background = 'linear-gradient(145deg, #ff3366, #aa1133)'; s.style.borderColor = '#ff3366'; }); setTimeout(() => { document.querySelectorAll('.symbol-marker').forEach(m => m.classList.remove('error')); coordSlots.forEach(s => { s.style.background = ''; s.style.borderColor = ''; }); currentSequence = []; updateDisplay(); activateBtn.disabled = true; }, 800); }
        function startLockout() { isLocked = true; lockoutEndTime = Date.now() + 60000; lockoutTimer.classList.add('active'); symbolButtons.forEach(b => b.disabled = true); resetBtn.disabled = true; activateBtn.disabled = true; lockoutInterval = setInterval(() => { const r = Math.ceil((lockoutEndTime - Date.now()) / 1000); if (r <= 0) endLockout(); else lockoutText.textContent = `âš  SECURITY LOCKOUT: ${r}s âš `; }, 100); }
        function endLockout() { isLocked = false; lockoutTimer.classList.remove('active'); if (lockoutInterval) { clearInterval(lockoutInterval); lockoutInterval = null; } symbolButtons.forEach(b => b.disabled = false); resetBtn.disabled = false; statusText.textContent = 'Lockout cleared. Enter coordinates...'; statusText.style.color = ''; }
        function openPortal(name) { portalOpen = true; kawooshInner.classList.add('active'); kawoosh.classList.add('active'); soundEngine.playKawoosh(); particleSystem.burst(); setTimeout(() => { kawoosh.classList.remove('active'); kawooshInner.classList.remove('active'); eventHorizon.classList.add('active'); particleSystem.startVortex(); soundEngine.playEventHorizonAmbient(); statusText.innerHTML = `<div class="destination-name">${name}</div>`; }, 2000); symbolButtons.forEach(b => b.disabled = true); activateBtn.disabled = true; resetBtn.disabled = false; document.querySelectorAll('.symbol-marker').forEach((m, i) => setTimeout(() => m.classList.add('locked'), i * 50)); }
        function activatePortal() { const enc = btoa(currentSequence.join(',')); const dest = ENCODED_DESTINATIONS.find(d => d.coords === enc); if (dest) openPortal(atob(dest.name)); else { showError(); startLockout(); } }

        symbolButtons.forEach(b => b.addEventListener('click', () => addSymbol(b.dataset.index)));
        resetBtn.addEventListener('click', resetSequence);
        activateBtn.addEventListener('click', activatePortal);
        window.addEventListener('resize', () => { particleSystem.resize(); positionSymbols(); });
        updateDisplay();
    </script>
</body>
</html>
